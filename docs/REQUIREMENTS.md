# 美容師練習管理Webアプリ 要件定義書 (最終版 - 運用ルール追記)

## 1. 概要

本ドキュメントは、現在Googleフォームで運用されている美容師の練習記録管理を、より効率的かつ柔軟に行うためのWebアプリケーション（以下、本アプリ）の要件を定義するものである。本アプリは、ログイン機能による入力者特定、練習内容の記録（詳細技術項目は1記録につき1項目）、ウィッグ在庫の簡易管理、およびデータの集計・分析の基盤となるデータの収集を目的とする。データは既存のGoogleフォーム回答とは別の新しいGoogleスプレッドシートシートに出力する。

## 2. 背景と目的

### 背景

*   現在、Googleフォームを利用して複数店舗（4店舗）のアシスタントの練習記録を管理している。
*   データはGoogleスプレッドシートに集約されている。
*   練習記録時、毎回名前や店舗を選択する必要があり、入力に手間がかかっている。
*   現状のフォームでは、詳細技術項目を複数選択できないため、複数項目練習した場合に複数回入力する必要がある。（※アプリでもこの運用を踏襲）
*   練習に複数のトレーナーが関与する場合があるが、既存の集計・分析への影響を最小限に抑えつつ記録する必要がある。
*   選択肢に応じた項目の動的表示、選択肢の管理、ウィッグ使用状況の管理などに課題があり、より使い勝手の良いシステムが求められている。
*   スタッフ情報は別途スプレッドシート（スタッフマスターシート）で管理されている。
*   将来的にはスタイリストの練習管理への拡張も視野に入れている。

### 目的

*   ログイン機能を提供し、記録者（スタッフ）を特定することで、名前・役職・店舗などの入力を自動化し、入力負荷を大幅に軽減する。
*   スタッフマスターシートの情報を活用し、ログインユーザーに応じた情報を自動表示する。
*   店舗、役職、技術カテゴリーに応じて入力項目を動的に変化させ、入力効率を向上させる。
*   一度の記録では一つの詳細技術項目のみを記録する運用を維持しつつ、アプリでの入力を簡便化する。
*   複数トレーナーが関与した場合、代表者1名を選択し、他はメモとして記録することで、既存のデータ分析への影響を抑える。
*   新品ウィッグの使用数を記録し、店舗ごとの在庫数を簡易的に管理する。
*   店舗、トレーナー、練習項目などのマスターデータをアプリ上で管理可能にする（スタッフ情報はマスターシート参照を基本とする）。
*   スマートフォンからの入力操作性を向上させる。
*   収集したデータを、保守性・拡張性を考慮した形で新しいGoogleスプレッドシートシートに出力する。

## 3. システム構成

*   **フロントエンド:** Webブラウザ (HTML, CSS, JavaScript)
*   **バックエンド:** Google Apps Script
*   **データベース:** Google スプレッドシート
    *   スタッフマスター
    *   練習記録 (新規シート)
    *   ウィッグ在庫
    *   選択肢マスター

## 4. 機能要件

### 4.0 ログイン機能

*   **4.0.1 ユーザー認証:** Googleアカウント認証を推奨。代替としてID/パスワード認証も考慮。
*   **4.0.2 ユーザー情報取得:** 認証成功後、スタッフマスターシートからユーザー情報を取得する。
*   **4.0.3 ログアウト機能:** ユーザーが明示的にログアウトできる機能。

### 4.1 ユーザー向け機能（練習記録入力画面） - ログイン後の画面

| No.     | 機能名                | 概要                                                                                                | 詳細仕様・補足                                                                                                                                                                                                                                                                    |
| :------ | :-------------------- | :-------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| (自動)  | 店舗表示              | ログインユーザーの所属店舗を自動表示する。                                                          | ログイン時にスタッフマスターシートから取得した店舗情報を表示（編集不可）。                                                                                                                                                                                                                  |
| (自動)  | 役職表示              | ログインユーザーの役職を自動表示する。                                                              | ログイン時にスタッフマスターシートから取得した役職情報（Role）を表示（編集不可）。この役職に基づき、表示される「技術カテゴリー」「詳細技術項目」が変動する。                                                                                                                                  |
| (自動)  | 名前表示              | ログインユーザーの名前を自動表示する。                                                              | ログイン時にスタッフマスターシートから取得した名前情報を表示（編集不可）。                                                                                                                                                                                                                  |
| 4.1.4   | トレーナー選択          | 練習を指導したトレーナーの名前を1名選択する。「自主練」「その他」「他店舗トレーナー」も選択肢に含む。 | ドロップダウンリスト形式（単一選択）。初期表示では、ログインユーザーの所属店舗に紐づくトレーナーのみが表示される。加えて、「自主練」「その他」「他店舗トレーナー」の選択肢を常に表示する。「他店舗トレーナー」を選択した場合、全店舗のトレーナーリストが動的に表示され、そこから選択できるようにする。選択肢は管理者機能で管理。※複数トレーナー関与時の運用ルールは別途定める(8.参照)。 |
| 4.1.5   | 練習日入力            | 練習を行った日付を入力する。                                                                        | 日付選択カレンダー形式。デフォルトで入力画面を開いた当日を表示。                                                                                                                                                                                                                          |
| 4.1.6   | 練習時間入力          | 練習に費やした時間（0.5時間刻み）を選択する。                                                       | ドロップダウンリスト形式。選択肢: 0, 0.5, 1.0, ..., 12.0。                                                                                                                                                                                                                            |
| 4.1.7   | 技術カテゴリー選択    | 練習した技術の大分類を選択する。（カット、カラー、パーマなど）                                      | ドロップダウンリスト形式。選択肢は管理者機能で管理。ログインユーザーの役職に基づき、表示されるカテゴリーが変わる。                                                                                                                                                                            |
| 4.1.8   | 詳細技術項目選択      | 4.1.7「技術カテゴリー選択」で選んだカテゴリーに属する具体的な練習項目を1つ選択する。                   | 同一画面内に動的に表示されるドロップダウンリスト形式（単一選択）。選択肢は管理者機能で管理し、カテゴリーと紐付ける。※複数項目を練習した場合は、項目ごとに記録を分けて入力する運用とする。                                                                                                |
| 4.1.9   | 練習回数入力          | 今日の練習回数（モデルの場合は人数）を選択する。                                                    | ドロップダウンリスト形式。選択肢: 0回, 1回, ..., 8回。                                                                                                                                                                                                                                   |
| 4.1.10  | 新品ウィッグ使用数入力 | 今回の練習で使用した「新品」のウィッグ数を入力する。                                                | ドロップダウンリスト形式（例: 0, 1, 2, 3, 4, 5）。常に表示。デフォルトは0。                                                                                                                                                                                                           |
| 4.1.11  | 評価入力              | 練習項目の習得度合いを評価する（1～10段階）。合格基準は7点。                                        | 1から10までの数値を選択する形式。4.1.4「トレーナー選択」で「自主練」が選択された場合は、この項目を非表示または入力不可にする。それ以外の場合は入力必須とする。                                                                                                                          |
| 4.1.12  | その他詳細入力        | 補足事項や具体的な内容などを自由記述で入力する。※複数トレーナー関与時は、代表以外のトレーナー名をここに記載する。 | テキストエリア形式。常に表示・入力可能。                                                                                                                                                                                                                                            |
| 4.1.13  | データ送信            | 入力された内容を確定し、新しいGoogle スプレッドシートシートに記録する。また、入力された「新品ウィッグ使用数」に基づき、該当店舗のウィッグ在庫数を更新する。 | 送信ボタン。送信後、入力内容をクリアし、成功メッセージを表示。必須項目（トレーナー(自主練除く)、練習日、練習時間、技術カテゴリ、詳細技術項目、練習回数、評価(自主練除く)）が未入力の場合はエラーメッセージを表示。「新品ウィッグ使用数」は必須ではない。ログインユーザー情報は自動記録。在庫更新処理を含む。                                                               |

### 4.2 管理者向け機能（選択肢・在庫管理画面）

*   **管理者認証:** 特定のGoogleアカウントでのログイン、または特定の権限を持つユーザーのみアクセス可能とする。
*   **4.2.1 店舗管理:** 店舗情報の追加、編集、削除。
*   **4.2.2 役職管理:** 役職情報の追加、編集、削除。技術カテゴリーとの紐付けも考慮。
*   **4.2.3 スタッフ情報参照:** スタッフマスターシートの内容を読み取り専用で表示。（編集はマスターシートで行う）
*   **4.2.4 トレーナー管理:** トレーナー情報の追加、編集、削除。所属店舗との紐付け。
*   **4.2.5 技術カテゴリー管理:** 技術カテゴリーの追加、編集、削除。役職との紐付け。
*   **4.2.6 詳細技術項目管理:** 詳細技術項目の追加、編集、削除。技術カテゴリーとの紐付け。
*   **4.2.7 ウィッグ在庫管理:** 店舗ごとのウィッグ在庫数を表示、手動での調整（棚卸し結果反映など）機能。

## 5. データ要件

### 5.1 参照データ: スタッフマスターシート

Google スプレッドシートで管理。アプリからは原則読み取り。

*   **必須列:**
    *   社員番号 (一意のID)
    *   名前
    *   Role (役職)
    *   店舗
    *   メールアドレス (Google認証時)
    *   (任意) パスワードハッシュ (ID/PW認証時)
    *   (任意) 管理者フラグ (管理者判定用)

### 5.2 入力データ項目一覧 (スプレッドシート記録用)

アプリから練習記録シートに書き込まれるデータ項目。

*   店舗名
*   役職名
*   スタッフ名
*   トレーナー名 (単一)
*   練習日
*   練習時間
*   技術カテゴリー名
*   詳細技術項目名 (単一)
*   練習回数
*   新品ウィッグ使用数
*   評価 (1-10, 自主練時は空欄)
*   その他詳細
*   記録日時 (自動)
*   社員番号 (ログイン情報から)
*   (任意) アプリバージョン

### 5.3 Google スプレッドシート連携仕様 (練習記録)

*   **書き込み先:** 新規の Google スプレッドシートシート (例: `アプリ練習記録_RAW`)
*   **書き込みデータ列構成:**

| 列名                | データ型      | 備考                                    |
| :------------------ | :------------ | :-------------------------------------- |
| 記録日時            | タイムスタンプ | スクリプト実行時に自動記録              |
| 店舗                | テキスト      | ログイン情報から自動入力                |
| 役職                | テキスト      | ログイン情報から自動入力                |
| 名前                | テキスト      | ログイン情報から自動入力                |
| 社員番号            | テキスト/数値 | ログイン情報から自動入力                |
| トレーナー          | テキスト      | 単一選択されたトレーナー名              |
| 練習日              | 日付          | ユーザー入力                            |
| 練習時間            | 数値          | ユーザー入力 (例: 1.5)                  |
| 技術カテゴリー      | テキスト      | ユーザー選択                            |
| 詳細技術項目        | テキスト      | 単一選択された項目名                    |
| 練習回数            | 数値          | ユーザー入力                            |
| 新品ウィッグ使用数  | 数値          | ユーザー入力 (デフォルト0)              |
| 評価                | 数値 (1-10)   | ユーザー入力 (自主練の場合は空欄/null) |
| その他詳細          | テキスト      | ユーザー入力 (複数トレーナー時追記など) |
| (任意)アプリバージョン | テキスト      | デプロイバージョンなど（保守用）          |

### 5.4 ウィッグ在庫データ

*   **管理方法:** 別の Google スプレッドシートシート (例: `ウィッグ在庫`) または簡易DB
*   **データ項目:**
    *   店舗名
    *   在庫数

## 6. 非機能要件

| No.   | 要件項目        | 内容                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| :---- | :-------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 6.1   | UI/UX           | スマートフォンでの片手操作でも入力しやすいレイアウト、デザインを考慮する。PCでの利用も可能なレスポンシブ対応。ログイン状態が分かりやすく表示されること。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 6.2   | パフォーマンス    | ログイン処理、スタッフマスターシートからの情報取得、動的な項目表示は、ストレスなく即座に行われること。在庫更新処理がユーザーの操作をブロックしないように非同期で行うなどの配慮。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 6.3   | セキュリティ      | 一般ユーザーはGoogleアカウント認証またはID/パスワード認証によりアクセスを制御する。管理者機能へのアクセスは、特定のGoogleアカウントでログインしているユーザーのみ許可する（またはスタッフマスターの権限フラグ参照）。スタッフマスターシートへのアクセス権限は適切に設定する（アプリからは原則読み取りのみ）。入力値の検証（バリデーション）を適切に行う。 パスワード認証の場合はパスワードの安全な保管（ハッシュ化）を行う。基本的なWebセキュリティ対策（XSS対策、クリックジャッキング対策など）を考慮する。                                                                                                                                                                                                                                                                                                                                       |
| 6.4   | 保守性・拡張性  | 以下の原則に基づき、将来的な変更や機能追加に対応しやすく、他の開発者が理解・修正しやすいコードを実装する。<br>**・可読性:**<br> - 一貫性のある分かりやすい命名規則（変数、関数等）を用いる。<br> - 適切なインデント、空白、コメントを使用し、コードの意図を明確にする。<br>**・モジュール性:**<br> - 機能を独立した小さな単位（関数、クラス等）に分割し、各単位は単一の責務を持つように設計する。<br> - モジュール間の依存関係を疎結合に保つ。<br>**・再利用性:**<br> - 共通ロジックは関数化するなどして再利用を図る。マジックナンバーを避け、定数を活用する。<br>**・柔軟性:**<br> - 設定値やマスターデータ（スプレッドシート）を活用し、ハードコーディングを最小限に抑える。<br> - 将来的なスタイリスト向け項目追加などを考慮した設計とする。 |
| 6.5   | テスト容易性    | （可能であれば）ユニットテスト等のテストが実施しやすいように、副作用を抑えた設計を心がける。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 6.6   | エラーハンドリング | APIエラー、データ不整合、予期せぬ例外などが発生した場合に、適切なエラーメッセージをユーザーに表示し、開発者が原因を特定しやすいようにログ出力 (`Logger.log`, Stackdriver Logging等) を行う。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

## 7. 画面イメージ（ワイヤーフレーム案）

(変更なし、詳細技術項目はドロップダウン想定)

*   ログイン画面
*   入力画面 (ユーザー向け)
*   管理者画面 (選択肢・在庫管理など)

*(※具体的なワイヤーフレームは別途作成または既存のものを参照)*

## 8. 開発上の考慮事項・制約事項

*   **コーディング規約:** 開発チーム内（現在は個人でも将来を見据え）でコーディング規約（命名規則、インデントスタイル等）を定め、遵守することが望ましい。
*   **バージョン管理:** Git等のバージョン管理システムを使用し、変更履歴を適切に管理する。
*   **フレームワーク・ライブラリ:** （もし利用する場合）選定理由とバージョンを明確にし、適切に利用する。
*   **ドキュメント:** コード内のコメントに加え、本ドキュメントや開発ガイドなど、必要な外部ドキュメントを作成・更新する。
*   **データ出力先:** 本アプリのデータは、既存のGoogleフォーム回答シートとは別の、新しい専用シート (`アプリ練習記録_RAW` など) に出力する。既存集約シートへの反映は別途検討。
*   **詳細技術項目の入力:** 1記録につき1項目のみとする運用をユーザーに周知徹底する。複数項目練習時は分けて入力してもらう。
*   **トレーナー選択の運用:** 複数トレーナー関与時は代表1名を選択し、他のトレーナー名は「その他詳細」に記載する運用をユーザーに周知する。
*   **認証方式の決定:** Googleアカウント認証を基本とするか、ID/パスワード認証を実装するかを早期に決定する。ID/パスワード認証の場合はパスワード管理・リセット等の運用も必要。
*   **スタッフマスターシート:**
    *   アプリからの読み取り権限が必要。
    *   認証情報（メールアドレスや社員番号）と確実に紐づけられる列が必要。
    *   データの正確性・最新性はシート管理者の責任とする。
    *   マスターシートの列構成変更が発生した場合のアプリ側での対応方法（エラーハンドリング、設定変更等）を考慮しておく。
*   **スタイリスト向け項目:** 将来的な拡張のため、現時点では考慮する程度に留め、具体的な項目は別途定義が必要。
*   **Google Apps Script の制約:** 実行時間制限（6分/実行）、API呼び出し回数制限、同時実行数制限、トリガーの制限、認証・認可周りの仕様に注意して設計・実装する。
*   **データ移行:** 既存のGoogleフォームで収集したデータの移行は、本プロジェクトの範囲外とする。
*   **オフライン利用:** アプリケーションはオンライン環境での利用を前提とする。
*   **エラーハンドリング:** 非機能要件 6.6 に基づき、堅牢なエラーハンドリングを実装する。
*   **在庫数の整合性:** 在庫数はアプリからの簡易更新（使用数減算）のみ行う。棚卸し等による実際の在庫数との差異は、管理者機能による手動調整でカバーする運用とする。